<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.web.coffee.mapper.UserMapper">

    <resultMap id="UserMap" type="com.web.coffee.domain.UserDTO">
        <id     column="MEMBER_ID"  property="memberId"/>
        <result column="NAME"       property="name"/>
        <result column="JOB_TITLE"  property="jobTitle"/>
        <result column="ACTIVE_YN"  property="activeYn"/>
        <result column="CREATED_AT" property="createdAt"/>
        <result column="UPDATED_AT" property="updatedAt"/>
    </resultMap>

	<select id="listActiveMembers" resultMap="UserMap">
		SELECT a.MEMBER_ID
		     , a.NAME
		     , a.JOB_TITLE
		     , a.ACTIVE_YN
		     , a.CREATED_AT
		     , a.UPDATED_AT
		  FROM COFFEE_MEMBER a
		 WHERE ACTIVE_YN = 'Y'
		 ORDER BY NAME DESC
	</select>
	
	<select id="listActiveMembersAll" resultMap="UserMap">
		SELECT a.MEMBER_ID
		     , a.NAME
		     , a.JOB_TITLE
		     , a.ACTIVE_YN
		     , a.CREATED_AT
		     , a.UPDATED_AT
		  FROM COFFEE_MEMBER a
		 ORDER BY NAME DESC
	</select>
	
	<select id="retrieveMemberYn" resultType="java.lang.String">
		SELECT CASE WHEN ( COUNT(*) > 0 ) THEN 'Y' ELSE 'N' END AS resultCd
		  FROM COFFEE_MEMBER a
		 WHERE a.NAME = #{name}
	</select>
	
	<insert id="newMember">
		INSERT INTO COFFEE_MEMBER
		VALUES (
			COFFEE_MEMBER_SEQ.NEXTVAL
		  , #{userDTO.name}
		  , #{userDTO.jobTitle}
		  , 'Y'
		  , #{userDTO.createdAt}
		  , #{userDTO.updatedAt}
		)
	</insert>
	
	<update id="updateMemberActiveYn">
		UPDATE COFFEE_MEMBER
		   SET ACTIVE_YN  = #{active}
		     , UPDATED_AT = #{sysDt}
		 WHERE MEMBER_ID  = #{memberId}
	</update>
	
	<select id="retrieveMemberActiveYn" resultType="java.lang.String">
		SELECT CASE WHEN ( COUNT(*) > 0 ) THEN 'Y' ELSE 'N' END AS resultCd
		  FROM COFFEE_MEMBER a
		 WHERE a.MEMBER_ID = #{memberId}
		   AND a.ACTIVE_YN = 'Y'
	</select>
	
</mapper>
